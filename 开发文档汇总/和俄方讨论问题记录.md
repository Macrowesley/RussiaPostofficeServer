

[toc]

# ç¬¬ä¸€æ¬¡è®¨è®º

#### é‚®å±€è‡ªå·±çš„é‚®èµ„æœºï¼Œç§äººé‚®èµ„æœºï¼Œå¦‚ä½•è·å¾—ä½™é¢ï¼Ÿ

è´¦æˆ·ä½™é¢ä¸èƒ½å°äº0 ï¼Œä¿å­˜åœ¨ä¿„ç½—æ–¯æœåŠ¡å™¨

æ¯ä¸ªå®¢æˆ·æœ‰ä¸ªbalanceä½™é¢åœ¨ä¿„ç½—æ–¯æœåŠ¡å™¨



å®¢æˆ·ç­¾åˆåŒï¼Œä¿„ç½—æ–¯æœåŠ¡å™¨è´¦æˆ·å……é’±ï¼Œé‚®èµ„æœºæœ‰ä»»åŠ¡ï¼Œè¯·æ±‚ï¼Œæ‰£é’±ï¼Œè¿”å›OKï¼Œ





#### ä¸èƒ½ç›–10æ¬¡ä¸€æ ·çš„é‚®æˆ³ï¼Ÿ

ä¸èƒ½è¶…è¿‡10ä¸ª



#### tariff table

ä¿„ç½—æ–¯çš„æ–‡ä»¶ï¼Œé‚®æ”¿äººå‘˜åŠ è½½è¿›æœºå™¨ï¼Œæ“ä½œäººå‘˜æ‰§è¡Œæ‰“å°ä»»åŠ¡çš„æ—¶å€™ï¼Œéœ€è¦èµ„è´¹è¡¨ä¸­çš„æ•°æ®æ¥è®¡ç®—èµ„è´¹ 

ç±»å‹ã€ç‰©å“ã€é‡é‡ã€ä½“ç§¯

é‚®èµ„æœºæ¥æ”¶çš„äº§å“ç§ç±»æ¸…å•



#### taxVersioinä¸­çš„ç¨

æè¿°é—®é¢˜ï¼Œä¿„ç½—æ–¯ä¼šå›å¤



#### publickey

é‚®èµ„æœºé€šè¿‡å…¬é’¥ç”³è¯·æˆæƒï¼Œä¸šåŠ¡çš„æ—¶å€™ï¼Œå…¬é’¥æ˜¯å¯¹æ•°å­—ç­¾åçš„åŠ å¯†



#### åŸŸåé—®é¢˜

ç¿»å¢™

NDAè®¿é—®æˆæƒ



#### æŠ€æœ¯





#### é—ç•™é—®é¢˜

äºŒç»´ç æŠ€æœ¯æ–‡æ¡£

èµ„è´¹è¡¨ä¿¡æ¯

æµ‹è¯•é¡µé¢è®¿é—®ï¼Œçº¦å®šæ—¶é—´ï¼ŒNDAè®¿é—®æˆæƒ



# ç¬¬äºŒæ¬¡è®¨è®º

## æµ‹è¯•ç›¸å…³é—®é¢˜

1.  æ˜¯å¦ä»¥http://40.114.247.228:8080/swagger-ui/ä¸­çš„æ¥å£ä¿¡æ¯ä¸ºå‡†ï¼Ÿ
    ã€å›ç­”ã€‘æ˜¯çš„éœ€è¦æ›´æ–°

2.  æä¾›çš„æµ‹è¯•ç¯å¢ƒï¼šhttp://test.asufm-test.10.238.33.32.xip.io/rcs-manager åœ¨ä½¿ç”¨æä¾›çš„VPNåï¼Œæˆ‘ä»¬ä»£ç ä¸­è®¿é—® /frankMachines æ¥å£ï¼Œä½†æ˜¯ä¸€ç›´è¿”å›500é”™è¯¯ï¼Œæ˜¯å¦è¿˜éœ€è¦å…¶ä»–é…ç½®æ‰èƒ½æ­£å¸¸æµ‹è¯•ï¼Ÿ
    æŠ¥é”™æˆªå›¾å¦‚ä¸‹![image-20210510145746764](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210510145747.png)
    
    ã€å›ç­”ã€‘è¿™ä¸ªé¡µé¢éœ€è¦æ›´æ–°ï¼Œç­‰æ›´æ–°æƒ…å†µ
    204 ä¸€èˆ¬å°±æ²¡æœ‰å“åº”ä½“
3.  æä¾›çš„VPNè½¯ä»¶åœ¨è¿æ¥æˆåŠŸåï¼Œè½¯ä»¶æ˜¾ç¤ºåªèƒ½ä¿æŒ16ä¸ªå°æ—¶çš„VPNï¼Œä»¥åæŠ•å…¥ç”Ÿæˆåï¼Œæˆ‘ä»¬æœåŠ¡å™¨å’Œä¿„æ–¹æœåŠ¡å™¨åº”è¯¥æ˜¯ä¸€ç›´è¿æ¥çš„ï¼Œæ‰€ä»¥ï¼Œæ€ä¹ˆæ ·æ‰èƒ½è®©VPNä¸€ç›´ä¿æŒè¿æ¥å‘¢ï¼Ÿ

![image-20210510145912104](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210510145913.png)
ã€å›ç­”ã€‘è¯´è®¾ç½®æ—¶é—´ï¼Œä½†æ˜¯æ²¡æœ‰ï¼Œåªèƒ½æ‰‹åŠ¨äº†ï¼Œä»¥åå†æè¿™ä¸ªé—®é¢˜



4.  å½“æˆ‘ä»¬è¿™è¾¹ä»£ç å¼€å‘å®Œæ¯•ï¼Œå¦‚ä½•å’Œä¿„æ–¹ä¸€èµ·æµ‹è¯•æ•´ä¸ªæµç¨‹ï¼Ÿ



##  æ¥å£ä½¿ç”¨åœºæ™¯

1.   /frankMachines/{frankMachineId}/changeStatus 


     åœ¨Frank Machine Managementä¸­ï¼Œæœºå™¨çŠ¶æ€æ”¹å˜åä¼šè°ƒç”¨æ¥å£ï¼Œæˆ‘çŒœæµ‹
    
     authæ¥å£å¯¹åº”çš„çŠ¶æ€æ˜¯ENABLED
    
     unauth æ¥å£å¯¹åº”çš„çŠ¶æ€æ˜¯UNAUTHORIZED
    
     lost æ¥å£å¯¹åº”çš„çŠ¶æ€æ˜¯LOST
    
     å¯¹å—ï¼Ÿ
    
     In Frank Machine Management, the interface is called when the Machine state changes, I guess
    
     The AUTH interface change ENABLED state
    
     The UNAUTH interface change UNAUTH state
    
     The LOST interface change LOST state
    
     Isn't it?


â€‹     

     FMåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‘å‡ºè¿™5ç§çŠ¶æ€æ”¹å˜è¯·æ±‚ï¼š ENABLED, DEMO, BLOCKED, UNAUTHORIZED, LOST
    
     Under what circumstances does FM issue these 5 state change requests:  ENABLED, DEMO, BLOCKED, UNAUTHORIZED, LOST



1.   æœºå™¨å’Œä¿„ç½—æ–¯æœåŠ¡å™¨éƒ½æœ‰ä¸€æ ·çš„FrankMachineIdï¼Œé‚£ä¹ˆè¿™ä¸ªä¿¡æ¯æ˜¯å¦‚ä½•å†™åœ¨æœºå™¨ä¸­ï¼Œæ€ä¹ˆå’ŒæœåŠ¡å™¨åŒæ­¥ï¼Ÿé€šè¿‡å“ªä¸ªæ¥å£å®ç°çš„ï¼Ÿ
     ã€å›ç­”ã€‘å¾…ç¡®å®š

      ![image-20210518095951222](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210518102526.png)
     
2.   publicKey  å¦‚ä½•åˆ›å»ºï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
     ã€å›ç­”ã€‘å¾…å›å¤

3.  åœ¨asufm-rcs-service.yamlï¼Œæˆ‘ä»¬éœ€è¦å®ç°çš„æ¥å£æœ‰ /postOffices å’Œ /contractsï¼Œä½†æ˜¯ /contractsæ¥å£æºå¸¦çš„æ•°æ®ä¸­å°±åŒ…å«äº†postOffices æ•°æ®ï¼Œè¿™æ ·ï¼Œè¿™2ä¸ªæ¥å£æ˜¯å¦æœ‰é‡å¤äº†

    

4.  ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘/rateTables æ¥å£ï¼Œæˆ‘çš„ç†è§£æ˜¯æœºå™¨æ”¶åˆ°äº†æ–°çš„taxåï¼Œæˆ‘ä»¬æœåŠ¡å™¨å†é€šçŸ¥ä¿„ç½—æ–¯æœåŠ¡å™¨ï¼Œä½†æ˜¯ä½ ä»¬çš„æ–‡æ¡£ä¸­æè¿°çš„æ˜¯ä¸‹é¢çš„æµç¨‹ï¼Œç”¨çš„æ˜¯/frankMachinesæ¥å£æ¥é€šçŸ¥FMæˆåŠŸå¤„ç†äº†taxã€‚

    When will the /rateTables interface be called? My understanding is that after the machine receives the new tax, our server will notify the Russian server. However, your document describes the following process, which uses the/FrankMachines interface to notify FM that the tax has been successfully processed.

    ![image-20210813160255678](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210813160255.png)

    ![image-20210518101157608](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210518102434.png)

    RateTableFeedbackä¸­å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¦‚ä½•è·å–ï¼Ÿ

    What do you mean by parameters in RatetableFeedback? How do I create this parameter data?

     ![image-20210518101335739](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210518102521.png)

    

5.   å¼€å§‹æ‰“å°å·¥ä½œçš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½æ”¶ç¨ ï¼Œæ‰“å°æ—¶ç¨çš„æ”¶å–æ˜¯å¯è®¾ç½®çš„å— ï¼Ÿæ‰“å°çš„ç¥¨é¢æ˜¯æ”¶ç¨åçš„å€¼è¿˜æ˜¯æ²¡æœ‰æ”¶ç¨çš„å€¼ã€‚å’ŒæœåŠ¡å™¨ä¼ è¾“æ—¶å€™çš„æ•°å€¼æ˜¯å¸¦ç¨çš„è¿˜æ˜¯ä¸å¸¦ç¨çš„
     When FM start printing, is it tax in all cases? Is the tax collection settable when printing? Is the printed face the value after tax or the value without tax? And server transmission when the value is with tax or without tax



## æ¥å£å‚æ•°å«ä¹‰

1.   ä¸‹é¢é‡‘é¢çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ
     
    Foreseenä¸­çš„totalAmmount
    
    Transactionä¸­çš„creditValå’Œamount
    
    è¿”å›çš„Balanceä¸­çš„currentå’Œconsolidate
    
    What is the relationship between the following amounts?
    
    Foreseen: totalAmmount
    
    Transaction: CreditVal and Amount
    
    Balance: Current and consolidate
    
2.   /Foreseenæ¥å£å‚æ•°ä¸­ï¼š
     productsï¼šç®¡ç†å‘˜åœ¨åˆ›å»ºæ‰“å°ä»»åŠ¡çš„æ—¶å€™ï¼Œæ— æ³•çŸ¥é“æœ‰å“ªäº›å•†å“ï¼Œåªæœ‰æœºå™¨æ‰“å°å®Œæˆåï¼Œæ‰èƒ½çŸ¥é“æœ‰å“ªäº›å•†å“


     contractIdæ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿå¦‚æœæ˜¯åœ¨FMå±å¹•ä¸Šè¾“å…¥ï¼Œå¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œç›®å‰FMåªæ”¯æŒè¾“å…¥æ•°å­—ï¼Œä½†æ˜¯contractIdæ˜¯è‹±æ–‡æ•°å­—ç¬¦å·æ··åˆçš„
    
     userIdå’ŒproductCodeæ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ
    
     weightåœ¨æ²¡æœ‰ç§°çš„æƒ…å†µä¸‹åº”è¯¥å¦‚ä½•è®¡ç®—
    
     /Foreseen interface parameter:
    
     "Products": The administrator cannot know which products are available when creating the printing task. Only after the machine has finished printing, can  know which products are available


â€‹     

     "contractId": Where does contractId come from? This may be a bit of a problem if you're typing on an FM screen, which currently only supports typing numbers, but Contractid is a mixture of English numeric symbols
    
     Where do "userId" and "productCode" come from?
    
     How should "weight" be calculated if it is not weighed
    
     ![image-20210518102301064](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210518102301064.png)

3.   åœ¨Transactionæ¥å£ä¸­

     "graphId"æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

     "dm_message"å’Œ"dmMessage"æ˜¯ä¸æ˜¯é‡å¤äº†ï¼Œ

     "dmMessage"æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ
     

     In the Transaction interface

     What does "graphId" mean?

     Are "dm_message" and "dmMessage" duplicated,

     Where did the "dmMessage" data come from?

     ![image-20210518104357546](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210518151423.png)

4.  GET /rcsService æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

    PUT /rcsServiceä¸­å‚æ•°ä»€ä¹ˆæ„æ€ï¼Œå¦‚ä½•åˆ›å»ºï¼Ÿ

    What does the GET/RCSService interface do?
    What do parameters mean in the PUT/RCSService interface and how do they be created?

    ã€å›ç­”ã€‘It is not really public interface, it will be unavailable for external queries in production cases

     ![image-20210518105329956](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210518105330.png)

6.  æ‰“å°å‡ºæ¥çš„é‚®æˆ³ä¸­ï¼Œä¸‹é¢2ä¸ªæ•°æ®æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ
    How are the following two data generated in the printed postmark?

    address and other information field
    variable two-dimensi onal code field![image-20210517125824245](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210517125827.png)

    

# ç¬¬ä¸‰æ¬¡è®¨è®º

| Question                                                     | Answer                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.1. is totalAmmount in Foreseen contain VAT                 | No contain                                                   |
| 1.2. is totalAmmount in Foreseen contain VAT In the print job , whether the printed ticket face value contains the VAT | No contain                                                   |
| 2.When creating a Job, how to enter the contract number? We can only enter numbers, but the contract number is a mixture of numbers and English | Parameter contractId. Can you execute mapping operation between GUID and NUMBER on your side for compability with our system? |
| 3. In addition, the operator creating a job, can not know which goods, only after the machine printing completed, can know which goods | In order to answer your question send us all parameters for process creating a job at your system, please. |
| 4. How should weight be calculated if it is not weighed      | In order to answer your question send us all parameters for process creating a job at your system, please. |

 ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼š

ç¬¬ä¸€ï¼Œæˆ‘ä»¬æ— æ³•execute mapping operation between GUID and NUMBER 

ç¬¬äºŒï¼Œå³ä½¿æ˜ å°„äº†ï¼Œå®‰å…¨æ€§ä¹Ÿä¼šå˜å¾—å¾ˆå·®

ç¬¬ä¸‰ï¼Œå»ºè®®ä½¿ç”¨XXç®—æ³•ï¼Œå¾—åˆ°çš„åˆåŒå·éƒ½æ˜¯æ•°å­—ï¼Œä¹Ÿèƒ½ä¿è¯å®‰å…¨æ€§



# ç¬¬å››æ¬¡è®¨è®º

Hello, I have sorted out the existing problems. When can you give me the answer?  

1.  Have we solved the Contractid format problem we mentioned earlier? Could it be made up entirely of numbers?  
    
    **We are continuing to work on a solution to this problem. The solution will be provided in the next release.**

â€‹    å·²è§£å†³



2.  Access the /foreseens/{foreseenId}/cancel interface and  return okï¼Œ

<204,[Server:"nginx/1.19.2", Date:"Tue, 22 Jun 2021 10:40:42 GMT", Connection:"keep-alive"]>

should the return result have the Balance message?

**The returned result does not contain a balance message**

è¯´ä¸åŒ…å«ï¼Œæµ‹è¯•å†çœ‹å§

3.  First, I call the/foreseens interface and get the correct return, then revisit the /transactions interface and send the data  

{

  "id": "d520a464-fb84-4ed2-9818-d837ebae3b93",

  "foreseenId": "4efc5575-24e7-4956-88d4-c18753d29e86",

  "contractId": "190eac0d-844c-11e5-90db-2c59e5453bd0",

  "amount": 300,

  "contractNum": 0,

  "count": 30,

  "creditVal": 300,

  "frankMachineId": "FM100002",

  "taxVersion": "2.3.3",

  "userId": "11a8005e-6d6a-499d-9fca-82aa69103f90",

  "postOffice": "994700",

  "franks": [

â€‹    {

â€‹      "dmMessage": "message"

â€‹    },

â€‹    {

â€‹      "dmMessage": "message"

â€‹    }

  ],

  "graphId": "",

  "startDateTime": "2021-06-22T18:54:07.000+08:00",

  "stopDateTime": "2021-06-22T18:54:07.000+08:00"

}



error message returned:

{"code":1600,"message":"Internal Error"}



by the way, my Foreseens information is as follows

{

  "contractId": "190eac0d-844c-11e5-90db-2c59e5453bd0",

  "contractNum": 0,

  "frankMachineId": "FM100002",

  "id": "4efc5575-24e7-4956-88d4-c18753d29e86",

  "postOffice": "994700",

  "products": [

â€‹    {

â€‹      "amount": 100,

â€‹      "count": 10,

â€‹      "productCode": "2100",

â€‹      "weight": 10

â€‹    },

â€‹    {

â€‹      "amount": 200,

â€‹      "count": 20,

â€‹      "productCode": "2700",

â€‹      "weight": 10

â€‹    }

  ],

  "taxVersion": "2.3.3",

  "totalAmmount": 300,

  "totalCount": 30,

  "userId": "11a8005e-6d6a-499d-9fca-82aa69103f90"

}

**It is necessary to specify the correct value of the dmMessage parameter in the reques.for example: !45!01NE6434238001504211007130111638000026003100002200130941 (see the Datamatrix structure)**





I have some questions about the /transactions interface  

1.  You said dmMessage will be removed, but now it needs a special format. I'm a little confused  

2.  And I used dmMessage = "! 45! 01 ne6434238001504211007130111638000026003100002200130941 "this data to send, but still returns {" code" : 1600, the "message" : "Internal Error"}  

3.  If dmMessage has a special format, how to get this value?  



The last time you answered : 

![image-20210626094705870](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210626094706.png)

This time answered :

![image-20210626094935471](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210626094935.png)

4.  In addition, can you provide an example of QR contentï¼Ÿ

!45!01NE64360309424112020049813452039000230021000020001505680002Ã·â€¦ =Â¹Â§ÃŒqÂ»/x Ã‡Ã‹LËœ&0Ã”ÃÃ»#Ã”>Ã•Vâ€œÂ·Ã™Ã³Å’XEvÂºÆ’Ã’Å¡Ã«ÃÃ§quR

it contains datamatrix + keyRevision + signature



# ç¬¬äº”æ¬¡è®¨è®º

Thank you for your document. Now the format problem of contractId has been solved, but many attribute names have been changed in the document. Are we using this document as a standard? If so, I need to follow this document to modify our code and database.

 

In addition, I reorganized the unresolved issues. Please help me deal with them. Thank you !



 **1.We find information about the data matrix in specqr.docx file and there are some minor issues**

 

**1.1 Is this value a number in frankMachineIdï¼Ÿ**

For example, frankMachineId = FM100002, the Registration number of SMPC of FM is whether it should be 100002 ?

![img](http://gitee.com/FinishDream/blogImage1/raw/master/img/20210701110855.jpg) 

 *At the moment, the FM identifier is formed from the manufacturer's prefix (NE, PB, FP) and the registration number of the GZPO. So your guess is correct. This entails the following: FM that has not been registered with the state supervisory authority cannot be brought into the income protection system.*

 

 

**1.2 In the file, the customerID type is number, how does the FM get this value?**  

Our server got the customer information and 

customerID = 11A8005E-6D6A-499D-9FCA-82AA69103F90, type is string not number. 

![image-20210701130323941](http://gitee.com/FinishDream/blogImage1/raw/master/img/20210701130324.png) 

*This is a terminology feature caused by the limitations of current manufacturers. In fact, we work with Contracts and use ==Contract.code== for identification and printing of francs.*

 

**1.3 In the data matrix, the meaning of count, Postage, Weight is a little unclear.**

For example, in a Franking Jobs, 

ProductA's data is : count = 100, Postage = 100.01, Weight = 100.02 ProductB's data is : count = 200, Postage = 500, Weight = 200 ,

What should the values of these attributes be in the ProductA data matrix information? Is the count = 100, Postage = 10001, Weight = 10002 ?

If not, what value should it be?

![image-20210706092229739](https://gitee.com/FinishDream/blogImage1/raw/master/img/20210706092230.png)

!45!01NE64319660117042020051000531985000230021000002001148660002Ã¦Â’qÂÂ—ÃšÃ­h"xÂ±hÂ±BÂŸÂ‰ÃŠrÃŸhÂ·Ãˆ

è¯¦æƒ…ï¼š

! 45! 
01
NE
643
å—ç†é‚®å±€çš„å”¯ä¸€ID 196601
é‚®å¯„çš„æ—¥æœŸ 170420
FMçš„SMPCæ³¨å†Œå· 200510
é‚®èµ„ç›–å°å‰çš„æ³¨å†Œâ€œæ€»æ•°â€å€¼ 00531985
é‡‘é¢ 0002300
äº§å“ä»£ç  2100
äº§å“é‡é‡ 0002
å®¢æˆ·çš„å”¯ä¸€Id 00114866





*The Datamatrix contains the data of each impression of the mail item individually.*
*Example of an imprint of a postal item:*

*This imprint corresponds to Datamatrix =! 45! 01NE6431966011704202005100053198500023002100000200114866*
*This data is transferred to the ACSFM using / transactions (dmMessage parameter).*

 

**2. how you generate signatures? The signature on it is different from the signature we generate.**

 Digital signature is generated on FM. Please detail the question, if necessary.





# ç¬¬å…­æ¬¡è®¨è®º

![image-20211102094125979](https://gitee.com/FinishDream/blogImage1/raw/master/img/20211102094126.png)

![image-20211102094133553](https://gitee.com/FinishDream/blogImage1/raw/master/img/20211102094133.png)



