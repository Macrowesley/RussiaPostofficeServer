<style>
  #printJob-add {
    padding: 20px 25px 25px 0;
  }

  #printJob-add .layui-treeSelect .ztree li a, .ztree li span {
    margin: 0 0 2px 3px !important;
  }

  #printJob-add #data-permission-tree-block {
    border: 1px solid #eee;
    border-radius: 2px;
    padding: 3px 0;
  }

  .left-label {
    width: 20%;
  }

  .rigth-view {
    width: 80%;
  }

  /*.layui-form-select {width: 70%;}*/


</style>
<div class="layui-fluid" id="printJob-add">
  <form class="layui-form" action="" lay-filter="printJob-add-form">

    <div class="layui-form-item ">
      <label class="layui-form-label left-label" th:text="#{printJob.frankMachineId}+':'"></label>
      <div class="layui-input-block">
        <input type="text" name="frankMachineId" autocomplete="off"
               class="layui-input rigth-view">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label left-label" th:text="#{printJob.contractCode}+':'"></label>
      <div class="layui-input-block">
        <input type="text" name="contractCode" autocomplete="off"
               class="layui-input rigth-view">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label left-label" th:text="#{printJob.totalCount}+':'"></label>
      <div class="layui-input-block">
        <input type="number" name="totalCount" lay-verify="number" autocomplete="off"
               class="layui-input rigth-view">
      </div>
    </div>

    <!--购物车-->
    <div class="layui-form-item">
      <label class="layui-form-label left-label" th:text="#{printJob.products}+':'"></label>
      <div id="products">
        <div style="margin-left: 21%;" class="layui-card-body layui-row layui-col-space12">
          <div class="layui-col-md2">
            <input type="text" name="productCode" lay-verify="required" autocomplete="off" class="layui-input"
                   th:placeholder="#{printJob.products.productCode}">
          </div>
          <div class="layui-col-md2">
            <input type="number" name="count" lay-verify="required|number" autocomplete="off" class="layui-input"
                   th:placeholder="#{printJob.products.count}">
          </div>
          <div class="layui-col-md2">
            <input type="text" name="weight" lay-verify="required" autocomplete="off" class="layui-input"
                   th:placeholder="#{printJob.products.weight}">
          </div>
          <div class="layui-col-md2">
            <input type="text" name="amount" lay-verify="required" autocomplete="off" class="layui-input"
                   th:placeholder="#{printJob.products.amount}">
          </div>
          <div class="layui-col-md3">
            <input type="text" name="address" lay-verify="required" autocomplete="off" class="layui-input"
                   th:placeholder="#{printJob.products.address}">
          </div>
        </div>
      </div>
<!--
      <div class="layui-input-block layui-row" style="width: 95%">
        <div id="products" >
          <div class="layui-inline">
            <div class="layui-input-inline">
              <input type="text" name="productCode" lay-verify="required" autocomplete="off" class="layui-input"
                     th:placeholder="#{printJob.products.productCode}">
            </div>
          </div>
          <div class="layui-inline">
            <div class="layui-input-inline">
              <input type="number" name="count" lay-verify="required|number" autocomplete="off" class="layui-input"
                     th:placeholder="#{printJob.products.count}">
            </div>
          </div>
          <div class="layui-inline">
            <div class="layui-input-inline">
              <input type="text" name="weight" lay-verify="required" autocomplete="off" class="layui-input"
                     th:placeholder="#{printJob.products.weight}">
            </div>
          </div>
          <div class="layui-inline">
            <div class="layui-input-inline">
              <input type="text" name="amount" lay-verify="required" autocomplete="off" class="layui-input"
                     th:placeholder="#{printJob.products.amount}">
            </div>
          </div>
          <div class="layui-inline">
            <div class="layui-input-inline">
              <input type="text" name="address" lay-verify="required" autocomplete="off" class="layui-input"
                     th:placeholder="#{printJob.products.address}">
            </div>
          </div>
        </div>
      </div>
-->
    </div>

    <!--添加按钮-->
    <div class="layui-form-item">
      <label class="layui-form-label left-label"></label>
      <div class="layui-inline">
        <button class="layui-btn" id="addProduct" th:text="#{printJob.products.add}"></button>
      </div>

    </div>

    <div class="layui-form-item febs-hide">
      <button class="layui-btn" lay-submit="" lay-filter="printJob-add-form-submit" id="submit"></button>
      <button type="reset" class="layui-btn" id="reset"></button>
    </div>
  </form>
</div>

<script>
layui.use(['febs', 'form', 'formSelects', 'validate'], function () {
  var $ = layui.$,
    febs = layui.febs,
    layer = layui.layer,
    formSelects = layui.formSelects,
    form = layui.form,
    $view = $('#printJob-add'),
    validate = layui.validate,
    productIdex = 0;

  form.verify(validate)
  form.render()

  initSelect()


    /**
     * 添加产品事件
     */
    $("#addProduct").on("click", function () {
      productIdex = productIdex++;
      $("#products").append(
        '<div style="margin-left: 21%;" id="productItem'+productIdex+'" class="layui-card-body layui-row layui-col-space12 new-product">' +
        '<div class="layui-col-md2">\n' +
        '          <input type="text" name="productCode" lay-verify="required" autocomplete="off" class="layui-input"\n' +
        '                 placeholder="'+i18n("printJob.products.productCode")+'">\n' +
        '        </div>\n' +
        '        <div class="layui-col-md2">\n' +
        '          <input type="number" name="count" lay-verify="required|number" autocomplete="off" class="layui-input"\n' +
        '                 placeholder="'+i18n("printJob.products.count")+'">\n' +
        '        </div>\n' +
        '        <div class="layui-col-md2">\n' +
        '          <input type="text" name="weight" lay-verify="required" autocomplete="off" class="layui-input"\n' +
        '                 placeholder="'+i18n("printJob.products.weight")+'">\n' +
        '        </div>\n' +
        '        <div class="layui-col-md2">\n' +
        '          <input type="text" name="amount" lay-verify="required" autocomplete="off" class="layui-input"\n' +
        '                 placeholder="'+i18n("printJob.products.amount")+'">\n' +
        '        </div>\n' +
        '        <div class="layui-col-md2">\n' +
        '          <input type="text" name="address" lay-verify="required" autocomplete="off" class="layui-input"\n' +
        '                 placeholder="'+i18n("printJob.products.address")+'">\n' +
        '        </div>' +
        '        <div class="layui-col-md1">\n' +
        '          <button class="layui-btn" onclick="removeNode('+productIdex+')">'+i18n("rcs.delete")+'</button>' +
        '        </div>' +
        '</div>');

      return false;
    })

  /**
   * 删除最后一行
   */
  window.removeNode = function (id){
    productIdex = productIdex--;
    console.log("id = " + id)
    console.log("productIdex = " + productIdex)
    $("#productItem"+id).remove();
  }


  /**
   * 处理下拉框
   */
  function initSelect () {
    $.ajax({
      url: ctx + 'user/deptUserList',
      type: 'get',
      success: function (data) {
        $.each(data.data, function (index, item) {
          $('#userList').append('<option value=' + item.userId + '>' + item.username + '</option>')
        })
        layui.form.render('select')
      }
    })
  }

  form.on('submit(printJob-add-form-submit)', function (data) {
    var acnumList = data.field.acnumList
    if (acnumList.length > 8) {
      if (acnumList.indexOf(',') <= 0) {
        febs.alert.warn(i18n('printJob.splitWithdot'))
        return false
      }
    }
    var bindUserId = data.field.bindUserId
    if (bindUserId == '') {
      febs.alert.warn(i18n('printJob.selectBindUser'))
      return false
    }

    febs.modal.confirm(i18n('notice'), i18n('printJob.confirmBindUser'), function () {
      //检查是否重复
      febs.post(ctx + 'printJob/checkIsExist', { acnumList: acnumList }, function (res) {
        console.log(res)
        var res = res.data
        if (res.isExist == 1) {
          febs.alert.warn(i18n('acnum') + res.data + i18n('exist'))
          return false
        }
        // return false;

        //开始添加
        febs.post(ctx + 'printJob/add', data.field, function () {
          layer.closeAll()
          febs.alert.success(i18n('printJob.addprintJobSuccess'))
          $('#febs-printJob').find('#refreshQuery').click()
        })
      })
    })

    return false
  })
})
</script>